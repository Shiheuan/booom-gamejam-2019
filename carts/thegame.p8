pico-8 cartridge // http://www.pico-8.com
version 18
__lua__

-- game main loop

function _init()
    player:init()
    g_time = 0
end

function _update60()
    g_time+=1
    player:update()
end

function _draw()
    cls()
    map(0, 0, 0, 0, 16, 8)
    player:draw()
    --print(tile_at(1, 1), 58, 80, 5)
    --print(fget(18, 3), 58, 90, 5)
    --print(fget(18), 58, 100, 5)
    oprint(tile_flag_at(1, 1, 0), 58,70,7,5)
    coprint(cor("helloworld!"), 58,80,7,5)
end

--> 8
-- player entity

player = {}

function player:init()
    self.x = 20
    self.y = 20
    self.spr = 64
    self.speed = 0.5
end

function player:update()
    if (btn(2)) then self.y -= self.speed
    elseif (btn(3)) then self.y += self.speed
    elseif (btn(0)) then self.x -= self.speed
    elseif (btn(1)) then self.x += self.speed
    end
end

function player:draw()
    spr(self.spr, self.x, self.y)
end
--> 8
-- system

-- collision

function tile_flag_at(x, y, flag)
    if (fget(tile_at(x,y), flag)) then
        return true
    end
end

function tile_at(x, y)
    -- todo: motify each room
    return mget(x, y)
end

--> 8
-- helper

function oprint(s, x, y, c, o)
    print(s, x-1, y, o)
    print(s, x+1, y, o)
    print(s, x, y-1, o)
    print(s, x, y+1, o)
    print(s, x, y, c)
end

local chrs="avddakljkleauip12u9089$#u)*($#"

function cor(s)
    local i=(flr(g_time/3))%#s+1
    local id=flr(g_time/5)%#chrs+1
    local c=sub(chrs,id,id)
    s=sub(s,1,i-1)..c..sub(s,i+1,#s)
    
    return s
end

function coprint(s,y,c,o)
    oprint(s,64-#s*2,y,o or 0,c or 7)
end

__gfx__
00000000333332330101010100000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555552351010101200000000201010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700535552550101010200000000210101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000222222221010101200011000201010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000332333330101010200100010210101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700552355551010101200011000201010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000552555350101010200000000210101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000222222221010101200000000201010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000101010201010101210101010222222222222220000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000001010101210101010201010102010101010101012000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000101010201010101210101012101010101010102000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000001010101210101010201010102010101010101012000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000101010201010101210101012101010101010102000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000001010101210101010201010102010101010101012000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000101010201010101210101012101010101010102000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000001010101210101010201010102010101010101012000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000055555555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00666660006666600066666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06666666066666660666666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
066ffff6066ffff6066ffff600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06f0ff0606f0ff0606f0ff0600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06fffff006fffff006fffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00222200002222000022220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700007000700700070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000020002000000000000000000000000000301020202000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1313131313131313131313131313131300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1312010101010101010101141313131300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1312000000000000000000141313131300c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
131200000000000000000001010101010000c0c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
13120000000000000000000000c0c0c0c0c0c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
13120000000000000000001523232323c0c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313232323232323232323131313131300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313131313131313131313131313131300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313131313131313131313131313131300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
